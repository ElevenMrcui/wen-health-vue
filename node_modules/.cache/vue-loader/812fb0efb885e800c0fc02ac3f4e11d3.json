{"remainingRequest":"D:\\JavaProgram\\VSCode\\health114_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\JavaProgram\\VSCode\\health114_vue\\src\\views\\appoment\\ordersetting.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\JavaProgram\\VSCode\\health114_vue\\src\\views\\appoment\\ordersetting.vue","mtime":1605253146531},{"path":"D:\\JavaProgram\\VSCode\\health114_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1604539599577},{"path":"D:\\JavaProgram\\VSCode\\health114_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1604539598881},{"path":"D:\\JavaProgram\\VSCode\\health114_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1604539599577},{"path":"D:\\JavaProgram\\VSCode\\health114_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1604539608318}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQpleHBvcnQgZGVmYXVsdCB7DQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIGN1cmRheTogbmV3IERhdGUoKSwNCiAgICAgIHNldHRpbmdEYXRhOnt9LA0KICAgICAgc2V0dGluZ0RheTonJywNCiAgICAgIHNldHRpbmdEaWFsb2c6ZmFsc2UsDQogICAgICBudW1iZXI6JycsDQogICAgfTsNCiAgfSwNCiAgbWV0aG9kczp7CQ0KDQogICAgLy/kuIvovb3mlofku7YNCiAgICBkb3dubG9hZFRlbXBsYXRlKCl7DQogICAgICAvL2HmoIfnrb7lsZ7mgKfnmoR0YXJnZXQg77yaIF9ibGFuayjmiZPlvIDmlrDnqpflj6MpLCBfcGFyZW50KOacrOeql+WPo+aJk+W8gCksIF9zZWxmKOimhuebluacrOeql+WPoykgDQogICAgICB3aW5kb3cub3BlbignYXBpL3RlbXBsYXRlL29yZGVyc2V0dGluZ190ZW1wbGF0ZS54bHN4JywnX3BhcmVudCcpOw0KICAgIH0sDQoNCiAgICAvL+S4iuS8oOaWh+S7tg0KICAgIGJlZm9yZUF2YXRhclVwbG9hZChmaWxlKXsNCiAgICAgIC8v5Yik5pat5paH5Lu25LiK5Lyg57G75Z6LDQogICAgICBjb25zdCBpc1hsc3ggPSBmaWxlLnR5cGUgPT09ICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnOw0KICAgICAgaWYoIWlzWGxzeCl7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+ivt+S4iuS8oHhsc3jmlofku7YnKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBpc1hsc3g7DQogICAgfSwNCg0KICAgIC8v5paH5Lu25LiK5Lyg5oiQ5YqfDQogICAgaGFuZGxlU3VjY2VzcyhyZXMsZmlsZSl7DQogICAgICBpZihyZXMuZmxhZyl7DQogICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcygi5paH5Lu25LiK5Lyg5oiQ5YqfIik7DQogICAgICB9ZWxzZXsNCiAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMubWVzc2FnZSkNCiAgICAgIH0NCiAgICB9LA0KDQogICAgLy/mn6Xor6LpooTnuqbmlbDmja4NCiAgICBmaW5kU2V0dGluZ0RhdGUoeWVhcixtb250aCl7DQogICAgICAgIHRoaXMuJGh0dHAuZ2V0KCJhcGkvb3JkZXJTZXR0aW5nL2ZpbmRTZXR0aW5nRGF0YS8iK3llYXIrIi8iK21vbnRoKS50aGVuKChyZXMpPT57DQogICAgICAgICAgaWYocmVzLmRhdGEuZmxhZyl7DQogICAgICAgICAgICB0aGlzLnNldHRpbmdEYXRhID0gcmVzLmRhdGEuZGF0YQ0KICAgICAgICAgIH1lbHNlew0KICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMuZGF0YS5tZXNzYWdlKQ0KICAgICAgICAgIH0NCiAgICAgICAgfSkNCiAgICB9LA0KDQogICAgLy/orr7nva7lvLnnqpcNCiAgICBnb1NldHRpbmcoZGF5KXsNCiAgICAgIHRoaXMuc2V0dGluZ0RheSA9IGRheTsNCiAgICAgIHRoaXMuc2V0dGluZ0RpYWxvZyA9IHRydWUNCiAgICB9LA0KDQogICAgLy8NCiAgICBsb2FkRGF0YSgpew0KICAgICAgdGhpcy5maW5kU2V0dGluZ0RhdGUodGhpcy5jdXJkYXkuZ2V0RnVsbFllYXIoKSx0aGlzLmN1cmRheS5nZXRNb250aCgpKzEpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICANCiAgICB9LA0KDQogICAgLy8NCiAgICBoYW5kbGVVcGRhdGUoKXsNCiAgICAgIC8v5a6a5LmJ5qOA5p+l6L6T5YWl5pWw5o2u55qE5q2j5YiZ6KGo6L6+5byPDQogICAgICBsZXQgcmVnID0gL15bMC05XSpbMS05XVswLTldKiQvDQogICAgICBsZXQgZmxhZyA9IHJlZy50ZXN0KHRoaXMubnVtYmVyKTsNCiAgICAgIGlmKGZsYWcpew0KICAgICAgICAvL+WIpOaWrei+k+WFpeeahOaVsOaNruaYr+WQpuWkp+S6juW3sumihOe6puaVsA0KICAgICAgICBpZih0aGlzLm51bWJlciA+IHRoaXMuc2V0dGluZ0RhdGFbdGhpcy5zZXR0aW5nRGF5XS5yZXNlcnZhdGlvbnMpew0KICAgICAgICAgICAgdGhpcy4kaHR0cC5wdXQoImFwaS9vcmRlclNldHRpbmcvdXBkYXRlTnVtYmVyQnlPcmRlckRhdGUvIit0aGlzLm51bWJlcisiLyIrdGhpcy5zZXR0aW5nRGF5KS50aGVuKChyZXMpPT57DQogICAgICAgICAgICAgICAgaWYocmVzLmRhdGEuZmxhZyl7DQoNCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ0RhdGFbdGhpcy5zZXR0aW5nRGF5XS5udW1iZXIgPSB0aGlzLm51bWJlcg0KICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5nRGlhbG9nID0gZmFsc2UNCiAgICAgICAgICAgICAgICB9ZWxzZXsNCiAgICAgICAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IocmVzLmRhdGEubWVzc2FnZSkNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICB9ZWxzZXsNCiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKCLlvZPliY3pooTnuqbmgLvmlbDlsI/kuo7lt7LpooTnuqbmlbAiKQ0KICAgICAgfQ0KICAgICAgfWVsc2V7DQogICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoIuivt+i+k+WFpeato+aVtOaVsO+8gSIpDQogICAgICB9DQogICAgfQ0KICB9LA0KDQogIHdhdGNoOnsNCiAgICAvL+ebkeWQrOaXpeacn+aUueWPmOS6i+S7tg0KICAgIGN1cmRheShuZXdEYXRlLG9sZERhdGUpew0KICAgICAgaWYob2xkRGF0ZS5nZXRNb250aCgpICE9IG5ld0RhdGUuZ2V0TW9udGgoKSl7DQogICAgICAgIHRoaXMubG9hZERhdGEoKTsNCiAgICAgIH0NCiAgICB9DQogIH0sDQoNCiAgY3JlYXRlZCgpew0KICAgIC8vIHRoaXMuc2V0dGluZ0RhdGEgPSB7DQogICAgLy8gICAiMjAyMC0wOS0wMSI6e251bWJlcjoyMDAscmVzZXJ2YXRpb25zOjIwMH0sDQogICAgLy8gICAiMjAyMC0wOS0wMiI6e251bWJlcjoyMDAscmVzZXJ2YXRpb25zOjIwMH0sDQogICAgLy8gICAiMjAyMC0wOS0wNSI6e251bWJlcjoyMDAscmVzZXJ2YXRpb25zOjEwMH0sDQogICAgLy8gICAiMjAyMC0wOS0xNSI6e251bWJlcjoyMDAscmVzZXJ2YXRpb25zOjUwfSwNCiAgICAvLyAgICIyMDIwLTA5LTI4Ijp7bnVtYmVyOjEwMCxyZXNlcnZhdGlvbnM6OTB9DQogICAgLy8gfQ0KICAgIHRoaXMuZmluZFNldHRpbmdEYXRlKHRoaXMuY3VyZGF5LmdldEZ1bGxZZWFyKCksdGhpcy5jdXJkYXkuZ2V0TW9udGgoKSsxKTsNCiAgICB9DQogIH07DQo="},{"version":3,"sources":["ordersetting.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ordersetting.vue","sourceRoot":"src/views/appoment","sourcesContent":["<template>\r\n  <div>\r\n    <div class=\"content-header\">\r\n      <h1>\r\n        预约设置\r\n        <small>预约管理</small>\r\n      </h1>\r\n      <el-breadcrumb separator-class=\"el-icon-arrow-right\" class=\"breadcrumb\">\r\n        <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\r\n        <el-breadcrumb-item>预约管理</el-breadcrumb-item>\r\n        <el-breadcrumb-item>预约设置</el-breadcrumb-item>\r\n      </el-breadcrumb>\r\n    </div>\r\n    <div class=\"app-container\">\r\n      <div class=\"box\">\r\n        <div class=\"ordersetting\">\r\n          <el-card class=\"box-card\">\r\n            <div class=\"boxMain\">\r\n              <el-button style=\"margin-bottom: 20px;margin-right: 20px\" type=\"primary\" @click=\"downloadTemplate\">模板下载</el-button>\r\n              <el-upload\r\n                action=\"api/orderSetting/importOrderSettings\"\r\n                name=\"excelFile\"\r\n                :before-upload=\"beforeAvatarUpload\"\r\n                :on-success=\"handleSuccess\"\r\n                :show-file-list=\"false\"\r\n              >\r\n                <el-button type=\"primary\">上传文件</el-button>\r\n              </el-upload>\r\n            </div>\r\n            <div>\r\n              操作说明：请点击\"模板下载\"按钮获取模板文件，在模板文件中录入预约设置数据<br>\r\n              <span style=\"color: red\">日期格式为：yyyy/MM/dd</span><br>\r\n              点击\"上传文件\"按钮上传模板文件。\r\n            </div>\r\n          </el-card>\r\n\r\n          <el-calendar v-model=\"curday\">\r\n            <template\r\n              slot=\"dateCell\"\r\n              slot-scope=\"{date, data}\">\r\n              <div v-if=\"settingData[data.day]\">\r\n                \r\n                <div v-if=\"settingData[data.day].number == settingData[data.day].reservations\" \r\n                  style=\"background-color: #F5BCA9 ; height:85px;\">\r\n                 \r\n                  <div><font color='black'>{{data.day}}</font></div>\r\n                  \r\n                  <div>{{settingData[data.day].reservations}}/{{settingData[data.day].number}}</div>\r\n                  \r\n                  <div>预约已满</div>\r\n                </div>\r\n\r\n                <div v-else style=\"background-color:#C4EDCD ; height:85px;\">\r\n                \r\n                  <div><font color='black'>{{data.day}}</font></div>\r\n                \r\n                  <div>{{settingData[data.day].reservations}}/{{settingData[data.day].number}}</div>\r\n                \r\n                  <div><el-button size=\"small\"  @click=\"goSetting(data.day)\"  round>设置</el-button></div>\r\n\r\n                </div>\r\n              </div>\r\n\r\n              <div v-else>\r\n\r\n                <div v-if=\"data.type == 'current-month'\" style=\"padding-top:25px;\">\r\n                    <font color='black'>{{data.day}}</font>\r\n                    <el-button size=\"small\"  @click=\"goSetting(data.day)\"  round>设置</el-button>\r\n                    <!-- <button @click=\"goSetting(data.day)\"><i class=\"el-icon-setting\"></i>设置</button> -->\r\n                </div>\r\n                \r\n                <div v-else style=\"background-color:rgb(192,196,204);height:85px;width100%;\"></div>\r\n\r\n              </div>\r\n\r\n            </template>\r\n          </el-calendar>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n     <el-dialog title=\"预约设置\" :visible.sync=\"settingDialog\" width=\"30%\" top=\"15%\">\r\n       <div>日期:{{settingDay}}</div>\r\n       <el-input v-model=\"number\" placeholder=\"输入预约总人数\"></el-input>\r\n       <div slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"settingDialog = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"handleUpdate\">确定</el-button>\r\n      </div>\r\n     </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      curday: new Date(),\r\n      settingData:{},\r\n      settingDay:'',\r\n      settingDialog:false,\r\n      number:'',\r\n    };\r\n  },\r\n  methods:{\t\r\n\r\n    //下载文件\r\n    downloadTemplate(){\r\n      //a标签属性的target ： _blank(打开新窗口), _parent(本窗口打开), _self(覆盖本窗口) \r\n      window.open('api/template/ordersetting_template.xlsx','_parent');\r\n    },\r\n\r\n    //上传文件\r\n    beforeAvatarUpload(file){\r\n      //判断文件上传类型\r\n      const isXlsx = file.type ===  'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';\r\n      if(!isXlsx){\r\n        this.$message.error('请上传xlsx文件');\r\n      }\r\n      return isXlsx;\r\n    },\r\n\r\n    //文件上传成功\r\n    handleSuccess(res,file){\r\n      if(res.flag){\r\n        this.$message.success(\"文件上传成功\");\r\n      }else{\r\n        this.$message.error(res.message)\r\n      }\r\n    },\r\n\r\n    //查询预约数据\r\n    findSettingDate(year,month){\r\n        this.$http.get(\"api/orderSetting/findSettingData/\"+year+\"/\"+month).then((res)=>{\r\n          if(res.data.flag){\r\n            this.settingData = res.data.data\r\n          }else{\r\n            this.$message.error(res.data.message)\r\n          }\r\n        })\r\n    },\r\n\r\n    //设置弹窗\r\n    goSetting(day){\r\n      this.settingDay = day;\r\n      this.settingDialog = true\r\n    },\r\n\r\n    //\r\n    loadData(){\r\n      this.findSettingDate(this.curday.getFullYear(),this.curday.getMonth()+1);                                           \r\n    },\r\n\r\n    //\r\n    handleUpdate(){\r\n      //定义检查输入数据的正则表达式\r\n      let reg = /^[0-9]*[1-9][0-9]*$/\r\n      let flag = reg.test(this.number);\r\n      if(flag){\r\n        //判断输入的数据是否大于已预约数\r\n        if(this.number > this.settingData[this.settingDay].reservations){\r\n            this.$http.put(\"api/orderSetting/updateNumberByOrderDate/\"+this.number+\"/\"+this.settingDay).then((res)=>{\r\n                if(res.data.flag){\r\n\r\n                  this.settingData[this.settingDay].number = this.number\r\n                  this.settingDialog = false\r\n                }else{\r\n                  this.$message.error(res.data.message)\r\n                }\r\n            })\r\n        }else{\r\n          this.$message.error(\"当前预约总数小于已预约数\")\r\n      }\r\n      }else{\r\n        this.$message.error(\"请输入正整数！\")\r\n      }\r\n    }\r\n  },\r\n\r\n  watch:{\r\n    //监听日期改变事件\r\n    curday(newDate,oldDate){\r\n      if(oldDate.getMonth() != newDate.getMonth()){\r\n        this.loadData();\r\n      }\r\n    }\r\n  },\r\n\r\n  created(){\r\n    // this.settingData = {\r\n    //   \"2020-09-01\":{number:200,reservations:200},\r\n    //   \"2020-09-02\":{number:200,reservations:200},\r\n    //   \"2020-09-05\":{number:200,reservations:100},\r\n    //   \"2020-09-15\":{number:200,reservations:50},\r\n    //   \"2020-09-28\":{number:100,reservations:90}\r\n    // }\r\n    this.findSettingDate(this.curday.getFullYear(),this.curday.getMonth()+1);\r\n    }\r\n  };\r\n</script>\r\n\r\n<style scoped>\r\n.el-calendar-table .el-calendar-day{\r\n  padding: 0;\r\n}\r\n</style>\r\n"]}]}